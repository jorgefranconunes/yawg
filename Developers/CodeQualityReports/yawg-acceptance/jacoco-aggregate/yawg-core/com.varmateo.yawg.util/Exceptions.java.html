<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Exceptions.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Yawg acceptance tests</a> &gt; <a href="../index.html" class="el_bundle">yawg-core</a> &gt; <a href="index.source.html" class="el_package">com.varmateo.yawg.util</a> &gt; <span class="el_source">Exceptions.java</span></div><h1>Exceptions.java</h1><pre class="source lang-java linenums">/**************************************************************************
 *
 * Copyright (c) 2016-2017 Yawg project contributors.
 *
 **************************************************************************/

package com.varmateo.yawg.util;

import java.io.PrintWriter;
import java.io.StringWriter;
import java.lang.reflect.Constructor;
import java.text.MessageFormat;

import com.varmateo.yawg.api.YawgException;





/**
 * Utility methods for generating exceptions.
 */
public final class Exceptions {


    /**
     * No instances of this class are to be created.
     */
<span class="nc" id="L29">    private Exceptions() {</span>
<span class="nc" id="L30">    }</span>


    /**
     *
     */
    public static YawgException raise(
            final Throwable cause,
            final String    msgFmt,
            final Object... fmtArgs)
            throws YawgException {

<span class="nc" id="L42">        throw Exceptions.raise(YawgException.class, cause, msgFmt, fmtArgs);</span>
    }


    /**
     *
     */
    public static YawgException raise(
            final String    msgFmt,
            final Object... fmtArgs)
            throws YawgException {

<span class="nc" id="L54">        throw Exceptions.raise(YawgException.class, msgFmt, fmtArgs);</span>
    }


    /**
     * Throws an exception of the given type. The exception message is
     * constructed according to &lt;code&gt;java.text.MessageFormat&lt;/code&gt;
     * rules.
     *
     * @param &lt;T&gt; The type of the exception to be thrown.
     *
     * @param exceptionClass The Java class of the exception to the
     * thrown.
     *
     * @param msgFmt Format for the error message, with
     * &lt;code&gt;java.text.MessageForma&lt;/code&gt; conventions.
     *
     * @param fmtArgs Formating arguments used to create the error
     * message according to &lt;code&gt;java.text.MessageForma&lt;/code&gt;
     * conventions.
     */
    public static &lt;T extends RuntimeException&gt; T raise(
            final Class&lt;T&gt;  exceptionClass,
            final String    msgFmt,
            final Object... fmtArgs) {

<span class="fc" id="L80">        Throwable cause = null;</span>

<span class="nc" id="L82">        throw raise(exceptionClass, cause, msgFmt, fmtArgs);</span>
    }


    /**
     * Throws an exception of the given type and with the given
     * cause. The exception message is constructed according to
     * &lt;code&gt;java.text.MessageFormat&lt;/code&gt; rules.
     *
     * @param &lt;T&gt; The type of the exception to be thrown.
     *
     * @param exceptionClass The Java class of the exception to the
     * thrown.
     *
     * @param cause The cause to be assigned to the exception that
     * will be thrown.
     *
     * @param msgFmt Format for the error message, with
     * &lt;code&gt;java.text.MessageForma&lt;/code&gt; conventions.
     *
     * @param fmtArgs Formating arguments used to create the error
     * message according to &lt;code&gt;java.text.MessageForma&lt;/code&gt;
     * conventions.
     */
    public static &lt;T extends RuntimeException&gt; T raise(
            final Class&lt;T&gt;  exceptionClass,
            final Throwable cause,
            final String    msgFmt,
            final Object... fmtArgs) {

<span class="fc" id="L112">        T exception = newException(exceptionClass, cause, msgFmt, fmtArgs);</span>

<span class="fc" id="L114">        throw exception;</span>
    }





    /**
     *
     * Throws a checked exception of the given type and with the given
     * cause. The exception message is constructed according to
     * &lt;code&gt;java.text.MessageFormat&lt;/code&gt; rules.
     *
     * @param &lt;T&gt; The type of the checked exception to be thrown.
     *
     * @param exceptionClass The Java class of the exception to the
     * thrown.
     *
     * @param msgFmt Format for the error message, with
     * &lt;code&gt;java.text.MessageForma&lt;/code&gt; conventions.
     *
     * @param fmtArgs Formating arguments used to create the error message
     * according to &lt;code&gt;java.text.MessageForma&lt;/code&gt; conventions.
     *
     * @throws T The checked exception thrown by this method.
     */
    public static &lt;T extends Exception&gt; void
        raiseChecked(final Class&lt;T&gt;  exceptionClass,
                     final String    msgFmt,
                     final Object... fmtArgs)
        throws T {

<span class="nc" id="L146">        Throwable cause = null;</span>

<span class="nc" id="L148">        throw raiseChecked(exceptionClass, cause, msgFmt, fmtArgs);</span>
    }


    /**
     * Throws a checked exception of the given type and with the given
     * cause. The exception message is constructed according to
     * &lt;code&gt;java.text.MessageFormat&lt;/code&gt; rules.
     *
     * @param &lt;T&gt; The type of the exception to be thrown.
     *
     * @param exceptionClass The Java class of the exception to the
     * thrown.
     *
     * @param cause The cause to be assigned to the exception that
     * will be thrown.
     *
     * @param msgFmt Format for the error message, with
     * &lt;code&gt;java.text.MessageForma&lt;/code&gt; conventions.
     *
     * @param fmtArgs Formating arguments used to create the error
     * message according to &lt;code&gt;java.text.MessageForma&lt;/code&gt;
     * conventions.
     *
     * @throws T A checked exception type.
     */
    public static &lt;T extends Exception&gt; T
        raiseChecked(final Class&lt;T&gt;  exceptionClass,
                     final Throwable cause,
                     final String    msgFmt,
                     final Object... fmtArgs)
        throws T {

<span class="nc" id="L181">        T exception = newException(exceptionClass, cause, msgFmt, fmtArgs);</span>

<span class="nc" id="L183">        throw exception;</span>
    }


    /**
     *
     */
    private static &lt;T extends Exception&gt; T newException(
            final Class&lt;T&gt;  exceptionClass,
            final Throwable cause,
            final String msgFmt,
            final Object... fmtArgs) {

<span class="fc" id="L196">        Constructor&lt;T&gt; constructor = null;</span>

        try {
<span class="fc bfc" id="L199" title="All 2 branches covered.">            if ( cause == null ) {</span>
<span class="fc" id="L200">                constructor =</span>
<span class="fc" id="L201">                    exceptionClass.getConstructor(String.class);</span>
            } else {
<span class="fc" id="L203">                constructor =</span>
<span class="fc" id="L204">                    exceptionClass.getConstructor(String.class,Throwable.class);</span>
            }
<span class="fc" id="L206">        } catch ( NoSuchMethodException e ) {</span>
<span class="fc" id="L207">            String fmt   = &quot;No appropriate constructor on class {0}&quot;;</span>
<span class="fc" id="L208">            String errorMsg =</span>
<span class="fc" id="L209">                MessageFormat.format(fmt, exceptionClass.getName());</span>
<span class="fc" id="L210">            throw new IllegalArgumentException(errorMsg, e);</span>
<span class="fc" id="L211">        }</span>

<span class="fc" id="L213">        T result = null;</span>
<span class="fc" id="L214">        String msg = null;</span>

<span class="pc bpc" id="L216" title="1 of 4 branches missed.">        if ( (fmtArgs==null) || (fmtArgs.length==0) ) {</span>
<span class="fc" id="L217">            msg = msgFmt;</span>
        } else {
<span class="fc" id="L219">            msg = MessageFormat.format(msgFmt, fmtArgs);</span>
        }

        try {
<span class="fc bfc" id="L223" title="All 2 branches covered.">            if ( cause == null ) {</span>
<span class="fc" id="L224">                result = constructor.newInstance(msg);</span>
            } else {
<span class="fc" id="L226">                result = constructor.newInstance(msg, cause);</span>
            }
<span class="nc" id="L228">        } catch ( ReflectiveOperationException e ) {</span>
<span class="nc" id="L229">            String fmt   = &quot;Failed to create instance of class {0}&quot;;</span>
<span class="nc" id="L230">            String errorMsg =</span>
<span class="nc" id="L231">                MessageFormat.format(fmt, exceptionClass.getName());</span>
<span class="nc" id="L232">            throw new IllegalArgumentException(errorMsg, e.getCause());</span>
<span class="fc" id="L233">        }</span>

<span class="fc" id="L235">        return result;</span>
    }


    /**
     * Builds a string with the stack trace of the given
     * exception. The string is obtained directly from
     * &lt;code&gt;Throwable.printStackStrace(...)&lt;/code&gt;.
     *
     * &lt;p&gt;Mainly usefull for logging&lt;/p&gt;
     *
     * @param error The exception from which the stack trace will be
     * extracted.
     *
     * @return A string with the stack trace representation of the given
     * exception.
     */
    public static String getStackTrace(final Throwable error) {

<span class="nc" id="L254">        StringWriter buffer = new StringWriter();</span>
<span class="nc" id="L255">        PrintWriter  writer = new PrintWriter(buffer);</span>

<span class="nc" id="L257">        error.printStackTrace(writer);</span>

<span class="nc" id="L259">        String result = buffer.toString();</span>

<span class="nc" id="L261">        writer.close();</span>

<span class="nc" id="L263">        return result;</span>
    }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>