<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>BakerMatcher.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Yawg acceptance tests</a> &gt; <a href="../index.html" class="el_bundle">yawg-core</a> &gt; <a href="index.source.html" class="el_package">com.varmateo.yawg.core</a> &gt; <span class="el_source">BakerMatcher.java</span></div><h1>BakerMatcher.java</h1><pre class="source lang-java linenums">/**************************************************************************
 *
 * Copyright (c) 2016-2020 Yawg project contributors.
 *
 **************************************************************************/

package com.varmateo.yawg.core;

import java.nio.file.Path;

import io.vavr.Tuple;
import io.vavr.collection.HashMap;
import io.vavr.collection.Map;
import io.vavr.collection.Seq;
import io.vavr.control.Option;

import com.varmateo.yawg.util.GlobMatcher;


/**
 *
 */
/* package private */ final class BakerMatcher {


    private final Seq&lt;Entry&gt; _bakerTypes;


    /**
     *
     */
<span class="fc" id="L32">    private BakerMatcher(final Builder builder) {</span>

<span class="fc" id="L34">        _bakerTypes = builder._bakerTypes</span>
<span class="fc" id="L35">                .map(x -&gt; new Entry(x._1, x._2));</span>
<span class="fc" id="L36">    }</span>


    /**
     * Creates a new builder with no initializations.
     *
     * @return A newly created &lt;code&gt;Builder&lt;/code&gt; instance.
     */
    public static Builder builder() {

<span class="fc" id="L46">        return new Builder();</span>
    }


    /**
     * Creates a new builder initialized with the data from the given
     * &lt;code&gt;BakerMatcher&lt;/code&gt;.
     *
     * @param data Used for initializing the builder state.
     *
     * @return A newly created &lt;code&gt;Builder&lt;/code&gt; instance.
     */
    public static Builder builder(final BakerMatcher data) {

<span class="fc" id="L60">        return new Builder(data);</span>
    }


    /**
     *
     */
    public Option&lt;String&gt; bakerTypeFor(final Path path) {

<span class="nc" id="L69">        return _bakerTypes</span>
<span class="nc" id="L70">                .filter(entry -&gt; entry.matcher().test(path))</span>
<span class="nc" id="L71">                .map(Entry::mapType)</span>
<span class="nc" id="L72">                .headOption();</span>
    }


    /**
     * Intended for logging or debugging.
     *
     * @return The string representation of our matchers.
     */
    @Override
    public String toString() {

<span class="fc" id="L84">        return _bakerTypes</span>
<span class="fc" id="L85">                .sorted((o1, o2) -&gt; o1.mapType().compareTo(o2.mapType()))</span>
<span class="fc" id="L86">                .map(e -&gt; e.mapType() + &quot;:&quot; + e.matcher().toString())</span>
<span class="fc" id="L87">                .mkString(&quot;;&quot;);</span>
    }


    /**
     *
     */
    private static final class Entry {


        private final String _mapType;
        private final GlobMatcher _matcher;


        /**
         *
         */
        /* default */ Entry(
                final String mapType,
<span class="fc" id="L106">                final GlobMatcher matcher) {</span>

<span class="fc" id="L108">            _mapType = mapType;</span>
<span class="fc" id="L109">            _matcher = matcher;</span>
<span class="fc" id="L110">        }</span>


        /**
         *
         */
        public String mapType() {

<span class="fc" id="L118">            return _mapType;</span>
        }


        /**
         *
         */
        public GlobMatcher matcher() {

<span class="fc" id="L127">            return _matcher;</span>
        }


    }


    /**
     *
     */
    public static final class Builder {


        private Map&lt;String, GlobMatcher&gt; _bakerTypes;


        /**
         *
         */
<span class="fc" id="L146">        /* default */ Builder() {</span>

<span class="fc" id="L148">            _bakerTypes = HashMap.empty();</span>
<span class="fc" id="L149">        }</span>


        /**
         *
         */
<span class="fc" id="L155">        /* default */ Builder(final BakerMatcher data) {</span>

<span class="fc" id="L157">            _bakerTypes = HashMap.ofEntries(</span>
<span class="fc" id="L158">                    data._bakerTypes.map(e -&gt; Tuple.of(e.mapType(), e.matcher())));</span>
<span class="fc" id="L159">        }</span>


        /**
         *
         */
        public Builder addBakerType(
                final String bakerType,
                final GlobMatcher matcher) {

<span class="fc" id="L169">            _bakerTypes = _bakerTypes.merge(</span>
<span class="fc" id="L170">                    HashMap.of(bakerType, matcher),</span>
                    Builder::extendGlobMatcher);

<span class="fc" id="L173">            return this;</span>
        }


        private static GlobMatcher extendGlobMatcher(
                final GlobMatcher oldMatcher,
                final GlobMatcher newMatcher) {

<span class="nc" id="L181">            return GlobMatcher.builder(oldMatcher)</span>
<span class="nc" id="L182">                    .addGlobMatcher(newMatcher)</span>
<span class="nc" id="L183">                    .build();</span>
        }


        /**
         *
         */
        public Builder addBakerType(
                final String bakerType,
                final String... fileNames) {

<span class="fc" id="L194">            final GlobMatcher matcher = GlobMatcher.create(fileNames);</span>

<span class="fc" id="L196">            addBakerType(bakerType, matcher);</span>

<span class="fc" id="L198">            return this;</span>
        }


        /**
         *
         */
        public Builder addBakerTypes(final BakerMatcher that) {

<span class="fc" id="L207">            that._bakerTypes.forEach(e -&gt; addBakerType(e.mapType(), e.matcher()));</span>

<span class="fc" id="L209">            return this;</span>
        }


        /**
         *
         */
        public BakerMatcher build() {

<span class="fc" id="L218">            return new BakerMatcher(this);</span>
        }


    }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>